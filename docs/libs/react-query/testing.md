---
description: –°—Ç–∞—Ç—å—è –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–¥–∞ –≤ –∫–æ—Ç–æ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è React Query
---

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ React Query

–í–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–∑–Ω–∏–∫–∞—é—Ç –¥–æ–≤–æ–ª—å–Ω–æ —á–∞—Å—Ç–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ React Query, –ø–æ—ç—Ç–æ–º—É —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ –Ω–∏—Ö –∑–¥–µ—Å—å. –Ø –¥—É–º–∞—é, —á—Ç–æ –æ–¥–Ω–æ–π –∏–∑ –ø—Ä–∏—á–∏–Ω —ç—Ç–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ "—É–º–Ω—ã—Ö" –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (—Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ–º—ã—Ö [–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏](https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0)) –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –ø—Ä–æ—Å—Ç—ã–º –≤–æ–ø—Ä–æ—Å–æ–º. –° –ø–æ—è–≤–ª–µ–Ω–∏–µ–º —Ö—É–∫–æ–≤ —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –±—ã–ª –≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º. –¢–µ–ø–µ—Ä—å –ø–æ–æ—â—Ä—è–µ—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—É–∫–æ–≤ —Ç–∞–º, –≥–¥–µ –æ–Ω–∏ –Ω—É–∂–Ω—ã, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞—á—É –ø—Ä–æ–ø—Å–æ–≤ –≤–Ω–∏–∑.

–Ø —Å—á–∏—Ç–∞—é, —á—Ç–æ —ç—Ç–æ –≤ —Ü–µ–ª–æ–º –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è —Å–æ—Å–µ–¥—Å—Ç–≤–∞ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞, –Ω–æ —Ç–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –±–æ–ª—å—à–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–Ω–µ "–ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—Å–æ–≤".

–û–Ω–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useContext`. –û–Ω–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useSelector`. –ò–ª–∏ –æ–Ω–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useQuery`.

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —ç—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–æ–ª—å—à–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å—Ç—ã–º–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏—Ö –≤—ã–∑–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–∞–∑–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º. –ü—Ä–∏ –∏—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤–∞–º –Ω—É–∂–Ω–æ —Ç—â–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–∞—é—â–∏–µ —Å—Ä–µ–¥—ã, —á—Ç–æ–±—ã –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ.

## –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫–æ–≤ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ {#mocking-network-requests}

–ü–æ—Å–∫–æ–ª—å–∫—É React Query - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –≤–∞—à–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–µ—Ä–æ—è—Ç–Ω–æ –±—É–¥—É—Ç –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –±—ç–∫–µ–Ω–¥—É. –ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —ç—Ç–æ—Ç –±—ç–∫–µ–Ω–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö, –∏ –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω, –≤—ã, –≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–µ —Ö–æ—Ç–∏—Ç–µ –¥–µ–ª–∞—Ç—å –≤–∞—à–∏ —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å–∏–º—ã–º–∏ –æ—Ç —ç—Ç–æ–≥–æ.

–ï—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π –æ —Ç–æ–º, –∫–∞–∫ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é Jest. –í—ã –º–æ–∂–µ—Ç–µ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –∫–ª–∏–µ–Ω—Ç API, –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –æ–¥–∏–Ω. –í—ã –º–æ–∂–µ—Ç–µ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å fetch –∏–ª–∏ axios –Ω–∞–ø—Ä—è–º—É—é. –Ø –º–æ–≥—É —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç–æ, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–ª Kent C. Dodds –≤ —Å–≤–æ–µ–π —Å—Ç–∞—Ç—å–µ [Stop mocking fetch](https://kentcdodds.com/blog/stop-mocking-fetch):

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [Mock Service Worker](https://mswjs.io/) –æ—Ç [@ApiMocking](https://twitter.com/ApiMocking)

–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à–∏–º –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã, –∫–æ–≥–¥–∞ —Ä–µ—á—å –∏–¥–µ—Ç –æ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤–∞—à–∏—Ö API:

- —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Node –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è,
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç REST –∏ GraphQL,
- –µ—Å—Ç—å [–∞–¥–¥–æ–Ω –¥–ª—è storybook](https://storybook.js.org/addons/msw-storybook-addon), —Ç–∞–∫ —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –≤–∞—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö `useQuery`
- —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∏ –≤—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —É–≤–∏–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞,
- —Ä–∞–±–æ—Ç–∞–µ—Ç —Å cypress, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ñ–∏–∫—Å—Ç—É—Ä–∞–º.

–° –Ω–∞—à–∏–º —Å–µ—Ç–µ–≤—ã–º —É—Ä–æ–≤–Ω–µ–º –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ, –º—ã –º–æ–∂–µ–º –Ω–∞—á–∞—Ç—å –≥–æ–≤–æ—Ä–∏—Ç—å –æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è React Query –≤–µ—â–∞—Ö, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ:

## QueryClientProvider {#queryclientprovider}

–í—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ React Query, –≤–∞–º –Ω—É–∂–µ–Ω `QueryClientProvider` –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–º—É `queryClient` - —Å–æ—Å—É–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç `QueryCache`. –ö–µ—à, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∞—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

–Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–∞–∂–¥–æ–º—É —Ç–µ—Å—Ç—É —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `QueryClientProvider` –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å `new QueryClient` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞. –î—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥ –º–æ–∂–µ—Ç –∑–∞–∫–ª—é—á–∞—Ç—å—Å—è –≤ –æ—á–∏—Å—Ç–∫–µ –∫–µ—à–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞, –Ω–æ –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

### –î–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ö—É–∫–æ–≤ {#for-custom-hooks}

–ï—Å–ª–∏ –≤—ã —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ö—É–∫–∏, —è —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ [react-hooks-testing-library](https://react-hooks-testing-library.com/). –≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ö—É–∫–∏. –° –ø–æ–º–æ—â—å—é —ç—Ç–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –º—ã –º–æ–∂–µ–º –æ–±–µ—Ä–Ω—É—Ç—å –Ω–∞—à —Ö—É–∫ –≤ [–æ–±–µ—Ä—Ç–∫—É](https://react-hooks-testing-library.com/reference/api#wrapper), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç React, –æ–±–æ—Ä–∞—á–∏–≤–∞—é—â–∏–π —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ. –Ø —Å—á–∏—Ç–∞—é, —á—Ç–æ —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è QueryClient, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞:

```jsx title="wrapper"
const createWrapper = () => {
  // ‚úÖ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π QueryClient –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
  const queryClient = new QueryClient()
  return ({ children }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  )
}

test('my first test', async () => {
  const { result } = renderHook(() => useCustomHook(), {
    wrapper: createWrapper(),
  })
})
```

### –î–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ {#for-components}

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ö—É–∫ `useQuery`, –≤–∞–º —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å —ç—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ `QueryClientProvider`. –ù–µ–±–æ–ª—å—à–∞—è –æ–±–µ—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ `render` –∏–∑ [react-testing-library](https://testing-library.com/docs/react-testing-library/intro/) –∫–∞–∂–µ—Ç—Å—è —Ö–æ—Ä–æ—à–∏–º –≤—ã–±–æ—Ä–æ–º. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ React Query –¥–µ–ª–∞–µ—Ç —ç—Ç–æ [–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –¥–ª—è —Å–≤–æ–∏—Ö —Ç–µ—Å—Ç–æ–≤](https://github.com/tannerlinsley/react-query/blob/ead2e5dd5237f3d004b66316b5f36af718286d2d/src/react/tests/utils.tsx#L6-L17).

## –í—ã–∫–ª—é—á–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã {#turn-off-retries}

–≠—Ç–æ –æ–¥–Ω–∞ –∏–∑ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö "–ª–æ–≤—É—à–µ–∫" —Å React Query –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∏ –ø–æ–≤—Ç–æ—Ä–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞—à–∏ —Ç–µ—Å—Ç—ã –≤–µ—Ä–æ—è—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è –ø–æ —Ç–∞–π–º–∞—É—Ç—É, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–≤—Ç–æ—Ä—ã - —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ `QueryClientProvider`. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –≤—ã—à–µ:

```jsx title="no-retries" hl_lines="2-9"
const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: {
        // ‚úÖ –≤—ã–∫–ª—é—á–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        retry: false,
      },
    },
  })

  return ({ children }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  )
}

test("my first test", async () => {
  const { result } = renderHook(() => useCustomHook(), {
    wrapper: createWrapper()
  })
}
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ—Ä–µ–≤–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ "–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤". –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å, —á—Ç–æ —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –≤–∞—à —Ç–µ–∫—É—â–∏–π `useQuery` –Ω–µ –∏–º–µ–µ—Ç —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç 5 –ø–æ–≤—Ç–æ—Ä–æ–≤, –æ–Ω –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ.

### setQueryDefaults {#setquerydefaults}

–õ—É—á—à–∏–π —Å–æ–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —è –º–æ–≥—É –≤–∞–º –¥–∞—Ç—å –¥–ª—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã: –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ `useQuery`. –ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –∏ –µ—Å–ª–∏ –≤–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [queryClient.setQueryDefaults](https://tanstack.com/query/latest/docs/reference/QueryClient#queryclientsetquerydefaults).

–¢–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤ –≤ `useQuery`:

```jsx title="not-on-useQuery"
const queryClient = new QueryClient()

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  )
}

function Example() {
  // üö® you cannot override this setting for tests!
  const queryInfo = useQuery({
    queryKey: ['todos'],
    queryFn: fetchTodos,
    retry: 5,
  })
}
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```jsx title="setQueryDefaults" hl_lines="9-10"
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 2,
    },
  },
})

// ‚úÖ only todos will retry 5 times
queryClient.setQueryDefaults(['todos'], { retry: 5 })

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  )
}
```

–ó–¥–µ—Å—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –¥–≤–∞ —Ä–∞–∑–∞, —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å todos –±—É–¥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –ø—è—Ç—å —Ä–∞–∑, –∏ —É –º–µ–Ω—è –≤—Å–µ –µ—â–µ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–∫–ª—é—á–∏—Ç—å —ç—Ç–æ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–æ–∏—Ö —Ç–µ—Å—Ç–∞—Ö üôå.

### ReactQueryConfigProvider {#reactqueryconfigprovider}

–ö–æ–Ω–µ—á–Ω–æ, —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤. –ò–Ω–æ–≥–¥–∞ –≤–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—á–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–µ—Ä–µ–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –í v2 —É React Query –±—ã–ª ReactQueryConfigProvider –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª—É—á–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∏—Ç—å—Å—è —Ç–æ–≥–æ –∂–µ —Å–∞–º–æ–≥–æ –≤ v3 —Å –ø–æ–º–æ—â—å—é –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:

```jsx title="ReactQueryConfigProvider"
const ReactQueryConfigProvider = ({ children, defaultOptions }) => {
  const client = useQueryClient()
  const [newClient] = React.useState(
    () =>
      new QueryClient({
        queryCache: client.getQueryCache(),
        muationCache: client.getMutationCache(),
        defaultOptions,
      })
  )

  return (
    <QueryClientProvider client={newClient}>
      {children}
    </QueryClientProvider>
  )
}
```

–í—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å —ç—Ç–æ –≤ –¥–µ–π—Å—Ç–≤–∏–∏ –≤ —ç—Ç–æ–º [–ø—Ä–∏–º–µ—Ä–µ CodeSandbox](https://codesandbox.io/s/react-query-config-provider-v3-lt00f).

## –í—Å–µ–≥–¥–∞ –¥–æ–∂–∏–¥–∞–π—Ç–µ—Å—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ {#always-await-the-query}

–ü–æ—Å–∫–æ–ª—å–∫—É React Query –∞—Å–∏–Ω—Ö—Ä–æ–Ω–µ–Ω –ø–æ —Å–≤–æ–µ–π –ø—Ä–∏—Ä–æ–¥–µ, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ö—É–∫–∞ –≤—ã –Ω–µ –ø–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ. –û–±—ã—á–Ω–æ –æ–Ω –±—É–¥–µ—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏. [–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏](https://react-hooks-testing-library.com/reference/api#async-utilities) –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ react-hooks-testing-library –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ø–æ—Å–æ–±–æ–≤ —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã. –í —Å–∞–º–æ–º –ø—Ä–æ—Å—Ç–æ–º —Å–ª—É—á–∞–µ –º—ã –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ –¥–æ–∂–¥–∞—Ç—å—Å—è, –ø–æ–∫–∞ –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–π–¥–µ—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å–ø–µ—Ö–∞:

```jsx title="waitFor" hl_lines="21-24"
const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: {
        retry: false,
      },
    },
  })
  return ({ children }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  )
}

test("my first test", async () => {
  const { result, waitFor } = renderHook(() => useCustomHook(), {
    wrapper: createWrapper()
  })

  // ‚úÖ wait until the query has transitioned to success state
  await waitFor(() => result.current.isSuccess)

  expect(result.current.data).toBeDefined()
}
```

!!!danger "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ"
    –í –≤–µ—Ä—Å–∏–∏ [@testing-library/react v13.1.0](https://github.com/testing-library/react-testing-library/releases/tag/v13.1.0) —Ç–∞–∫–∂–µ –ø–æ—è–≤–∏–ª—Å—è –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ [renderHook](https://testing-library.com/docs/react-testing-library/api/#renderhook), –∫–æ—Ç–æ—Ä—ã–π –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –û–¥–Ω–∞–∫–æ –æ–Ω –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —É—Ç–∏–ª–∏—Ç—É `waitFor`, –ø–æ—ç—Ç–æ–º—É –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ [@testing-library/react](https://testing-library.com/docs/dom-testing-library/api-async/#waitfor). API –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–æ –æ–∂–∏–¥–∞–µ—Ç –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ `Promise`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –¥–æ–ª–∂–Ω—ã –Ω–µ–º–Ω–æ–≥–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à –∫–æ–¥:

    ```jsx title="new-render-hook" hl_lines="8-11"
    import { waitFor, renderHook } from '@testing-library/react'

    test("my first test", async () => {
      const { result } = renderHook(() => useCustomHook(), {
        wrapper: createWrapper()
      })

      // ‚úÖ return a Promise via expect to waitFor
      await waitFor(() => expect(result.current.isSuccess).toBe(true))

      expect(result.current.data).toBeDefined()
    }
    ```

## –°–æ–±–∏—Ä–∞—è –≤—Å–µ –≤–º–µ—Å—Ç–µ {#putting-it-all-together}

–Ø —Å–æ–∑–¥–∞–ª —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—Å–µ —ç—Ç–æ —Ö–æ—Ä–æ—à–æ —Å–æ—á–µ—Ç–∞–µ—Ç—Å—è: mock-service-worker, react-testing-library –∏ —É–ø–æ–º—è–Ω—É–∞—è –æ–±–µ—Ä—Ç–∫–∞. –í –Ω–µ–º —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è —á–µ—Ç—ã—Ä–µ —Ç–µ—Å—Ç–∞ - –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ –æ—à–∏–±–∫—É –∏ —É—Å–ø–µ—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ö—É–∫–æ–≤ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –í–∑–≥–ª—è–Ω–∏—Ç–µ –∑–¥–µ—Å—å: [https://github.com/TkDodo/testing-react-query](https://github.com/TkDodo/testing-react-query)

<small>:material-information-outline: –ò—Å—Ç–æ—á–Ω–∏–∫ &mdash; [https://tkdodo.eu/blog/testing-react-query](https://tkdodo.eu/blog/testing-react-query)</small>
